- 如何获取有性能问题的sql
  - 通过用户反馈获取存在性能问题的sql（只有发现问题才发现，对系统有影响），最好在用户发现之前
  - 通过慢查日志获取存在性能问题的sql
  - 实时获取存在性能问题的sql（数据库服务器压力突增）



#### 通过慢查日志获取存在性能问题的sql

性能开销较低，主要开销来自于磁盘IO和存储日志所需要的磁盘空间，写日志是顺序存储，其开销可以忽略不计。主要关注的问题是存储日志所需要的大量的磁盘空间。如果要记录所有的慢查询日志，很容易产生几百G甚至上T的日志，所以要对慢查询日志记录的sql进行控制。

有下列参数：

- slow_query_log 启动停止记录慢查询日志，默认mysql不会启动慢查询启动日志
  - 如果要启动则为on
  - 这个参数是动态参数，如果想在已经运行的mysql中启动慢查询日志，则使用 set gloabal 来启动命令
  - 如果要避免慢查询日志占用太多空间，可以在某个时间段内启动日志，
    - 通过脚本定时开关
- slow_query_log_file 指定慢查询日志的存储路径和文件，默认保存在mysql的数据目录中，最好将日志存储和数据存储分开
- Long_query_time 指定记录慢查询日志sql执行时间的伐值，参数单位是秒，默认值是10秒，通常改为0.001秒即1毫秒比较合适，要防止因为日志增长速度过快导致磁盘空间被占满
  - 慢查询日志会记录所有符合条件的sql，包括查询语句，数据修改语句，已经回滚的sql
- log_queries_not_using_indexes 是否记录未使用索引的sql